<div class="order-form-container">
  <div class="header">
    <h1>{{ isEditMode ? 'Editar Pedido' : 'Novo Pedido' }}</h1>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Carregando...</p>
  </div>

  <!-- Form -->
  <div *ngIf="!loading" class="form-content">
    <!-- Error Messages -->
    <div *ngIf="error" class="error-banner">
      <strong>{{ error }}</strong>
      <ul *ngIf="errors.length > 0">
        <li *ngFor="let err of errors">{{ err }}</li>
      </ul>
    </div>

    <!-- Customer Info -->
    <div class="form-card">
      <h2>Informa√ß√µes do Cliente</h2>
      <div class="form-group">
        <label for="customerId">Cliente ID</label>
        <input 
          type="text" 
          id="customerId" 
          [(ngModel)]="customerId" 
          class="form-control small-input"
          readonly>
        <small class="form-hint">Cliente fixo do sistema</small>
      </div>
    </div>

    <!-- Order Items -->
    <div class="form-card">
      <div class="card-header">
        <h2>Itens do Pedido</h2>
        <button class="btn btn-secondary btn-small" (click)="addItem()" [disabled]="loadingProducts">
          + Adicionar Item
        </button>
      </div>

      <div *ngIf="loadingProducts" class="loading-small">
        Carregando produtos...
      </div>

      <div *ngIf="!loadingProducts && products.length === 0" class="warning-banner">
        Nenhum produto dispon√≠vel. N√£o √© poss√≠vel criar pedidos.
      </div>

      <div *ngIf="!loadingProducts && products.length > 0" class="items-list">
        <div *ngFor="let item of orderItems; let i = index" class="item-row">
          <div class="item-number">{{ i + 1 }}</div>
          
          <div class="item-fields">
            <div class="form-group">
              <label>Produto</label>
              <select 
                [(ngModel)]="item.productId" 
                (ngModelChange)="onProductChange(item)"
                class="form-control">
                <option *ngFor="let product of products" [value]="product.id">
                  {{ product.name }} - {{ formatCurrency(product.price) }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Quantidade</label>
              <input 
                type="number" 
                [(ngModel)]="item.quantity" 
                min="1"
                step="1"
                pattern="[0-9]+"
                (keypress)="onlyNumbers($event)"
                class="form-control">
            </div>

            <div class="form-group">
              <label>Subtotal (Previs√£o)</label>
              <div class="subtotal-display">
                {{ formatCurrency(item.unitPrice * item.quantity) }}
              </div>
            </div>
          </div>

          <button 
            class="btn-remove" 
            (click)="removeItem(i)"
            [disabled]="orderItems.length === 1"
            title="Remover item">
            üóëÔ∏è
          </button>
        </div>
      </div>

      <!-- Total Preview -->
      <div class="total-preview" *ngIf="orderItems.length > 0">
        <span>Total (Previs√£o)</span>
        <strong class="total-amount">{{ formatCurrency(getPreviewTotal()) }}</strong>
      </div>
    </div>

    <!-- Edit Mode: Status -->
    <div class="form-card" *ngIf="isEditMode">
      <h2>Status do Pedido</h2>
      <div class="form-group">
        <label for="status">Status</label>
        <select id="status" [(ngModel)]="currentStatus" class="form-control">
          <option value="Pending">Pending</option>
          <option value="Paid">Paid</option>
          <option value="Shipped">Shipped</option>
          <option value="Cancelled">Cancelled</option>
        </select>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button class="btn btn-outline" (click)="cancel()" [disabled]="submitting">
        Cancelar
      </button>
      <button 
        class="btn btn-primary" 
        (click)="submitForm()" 
        [disabled]="submitting || loadingProducts || products.length === 0">
        <span *ngIf="!submitting">{{ isEditMode ? 'Atualizar Pedido' : 'Criar Pedido' }}</span>
        <span *ngIf="submitting">
          {{ isEditMode ? 'Atualizando e sincronizando...' : 'Criando e sincronizando...' }}
        </span>
      </button>
    </div>
  </div>
</div>

